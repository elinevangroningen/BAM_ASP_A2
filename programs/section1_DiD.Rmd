---
title: "section1_DiD"
author: "Eline van Groningen, Paola Priante, Valery Maasdamme, Yuhu Wang"
date: "9/25/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, 
                      comment = "", fig.height=2, fig.width=4, fig.align = "center")
```

# Difference-in-Difference Analysis: Female Labor Participation 

Downloading the libraries, setting the working directory and importing the data set 

```{r}
library(tidyverse)
library(stargazer)
library(dagitty)
library(gridExtra)
library(tinytex)
library(ggplot2)
library(tidyr)

dir <- "/Users/valeriemaasdamme/Documents/BAM_ASP_A2" 
dirProg <- paste0(dir, "/programs/") 
dirData <- paste0(dir, "/Data/")

dfDiD <- read.csv(file=paste0(dirData, "DiD_dataset.csv"))
```

## Preparing and analyzing the dataset 
There is need to transform the dataset as it is already in the long-format, with observations in different rows for different time periods. There is no need to transform character to factor as all variables seem to be either numeric or integer. 

```{r}

```

We have data from 1991 to 1996. In 1993, the EITC was implemented. A dummy variable *dPeriod* is created to indicate the time before and after the EITC policy. The years 1991 and 1992 take a value of 0, and 1993 and the years after 1993 take a value of 1.

The EITC policy only applies to women with children. Therefore, we need to compare two groups of women. A dummy variable *dChildren* is created to indicate the group of women with and without any children. Women with no children take a value of 0 (non-treated group), whereas women with 1 or more children take a value of 1 (treated group).

Furthermore, the EITC only applies to low-income workers. Therefore, women in both the treated and the non-treated group should be employed (*work* = 1). In order to estimate the DiD effect of the policy on annual earnings (*earn*) and annual family income (*finc*), we create a subset of women that are employed. 


```{r}
str(dfDiD)

dfDiD$dPeriod = ifelse(dfDiD$year >= 1993, 1, 0) 
dfDiD$cChildren = ifelse(dfDiD$children >= 1, 1, 0)

dfDiD.sub <- subset(dfDiD, work=="1")
```

## 1 Plotting the dependent variables 
In the graphs below, the three dependent variables (annual earnings, annual family income and work status) are plotted.  

to present visual evidence of the DiD effect. 

```{r}

ggplot(data = dfDiD, aes(year, earn, color = cChildren)) +
    stat_summary(geom = 'line') +
    geom_vline(xintercept = 1993) +
    theme_bw()

ggplot(data = dfDiD.sub, aes(year, earn)) + 
  stat_summary(geom = 'line') +
  geom_vline(xintercept = 1993) +
  theme_bw()

```

## 2 Summary statistics of the dataset 

```{r}
stargazer(dfDiD, type = "text")
stargazer(dfDiD[, c("children", "finc", "earn", "age", "work", "unearn")], type = "text")
```

The distriptive statistics table above show that there are 13,746 observations in the dataset. The average number of children women in the dataset have is 1.193. The average annual earnings and annual family income are and 10,432.48 and 15,255.32 US Dollars respectively. The women in the dataset are on average 35 years old. Approximately half of the women in the dataset is employed, as the average employment rate equals 0.513. 

## 3 Difference-in-Difference 
In order to difference-in-difference effects in a matrix, the averages of the dependent variables are computed per group per period. 


```{r}
avgEarn <- ddply (dfDiD.sub, .(dPeriod, cChildren), summarise, 
                 avgEarn = mean(earn, na.rm=TRUE))

avgFinc <- ddply (dfDiD.sub, .(dPeriod, cChildren), summarise, 
                 avgFinc = mean(finc, na.rm=TRUE))

avgWork <- ddply (dfDiD, .(dPeriod, cChildren), summarise, 
                 avgWork = mean(work, na.rm=TRUE))

#Remodel the avg table from long to wide, add  additional row for the difference in averages and rename the rows
avgtable.Earn <- dcast (avgEarn, dPeriod ~ cChildren, value.var = "avgEarn")
avgtable.Earn <- rbind(avgtable.Earn, avgtable.Earn[2,]-avgtable.Earn[1,]) 
rownames(avgtable.Earn) <- c("Before", "After", "Difference")
colnames(avgtable.Earn) <- c("dPeriod", "Women without children (0)", "Women with children (1)")
avgtable.Earn[3, "dPeriod"] <- NA

avgtable.Finc <- dcast (avgFinc, dPeriod ~ cChildren, value.var = "avgFinc")
avgtable.Finc <- rbind(avgtable.Finc, avgtable.Finc[2,]-avgtable.Finc[1,]) 
rownames(avgtable.Finc) <- c("Before", "After", "Difference")
colnames(avgtable.Finc) <- c("dPeriod", "Women without children (0)", "Women with children (1)")
avgtable.Finc[3, "dPeriod"] <- NA

avgtable.Work <- dcast (avgWork, dPeriod ~ cChildren, value.var = "avgWork")
avgtable.Work <- rbind(avgtable.Work, avgtable.Work[2,]-avgtable.Work[1,]) 
rownames(avgtable.Work) <- c("Before", "After", "Difference")
colnames(avgtable.Work) <- c("dPeriod", "Women without children (0)", "Women with children (1)")
avgtable.Work[3, "dPeriod"] <- NA

stargazer(avgtable.Earn, summary=FALSE, align = TRUE, type="text", title = "Average Annual Earnings")
stargazer(avgtable.Finc, summary=FALSE, align = TRUE, type="text", title = "Average Indicator Annual Family Income")
stargazer(avgtable.Work, summary=FALSE, align = TRUE, type="text", title = "Average Indicator Work Status")
```

As can be seen in the tables above, the average annual earnings of employed women without children decreased with 1,076.42 US Dollars after the implementation of the EITC. However, the average annual earnings of woman with children increased with 451,54 US Dollars after the implementation of the EITC. The difference-in-difference effect of the EITC on annual earnings of employed women is 1,076.42 $+$ 451.538 $=$ 1,527.96. 

Similarly, the average annual family income of employed women without children decreased with 1,348.46 US Dollars after the implementation of the EITC, whereas the average family income of women with children increased with 455.36 US Dollars after the EITC was implemented. The difference-in-difference effect of the EITC on annual family income of employed women is 1,348.46 $+$ 455.360 $=$ 1,803.82. 

The average rate of employment for women without any children decreased with 0.005 after the EITC was implemented. On the other hand, the average rate of employment for women with children increased with 0.026 after the implementation of the EITC. The difference-in-difference effect of the EITC on the number of women that are employed is 0.005 $+$ 0.026 $=$ 0.031. 

## 4 Regression analysis 
The following difference-in-difference models are estimated:

$$Earn = \beta_0 + \beta_1 cChildren + \beta_2 dPeriod + \beta_3 cChildren dPeriod + \varepsilon_i$$
$$Finc = \beta_0 + \beta_1 cChildren + \beta_2 dPeriod + \beta_3 cChildren dPeriod + \varepsilon_i$$
$$Work = \beta_0 + \beta_1 cChildren + \beta_2 dPeriod + \beta_3 cChildren dPeriod + \varepsilon_i$$

```{r}

mdlEarn <- earn ~ cChildren + dPeriod + cChildren:dPeriod
rsltOLSEarn <- lm(mdlEarn, data=dfDiD.sub)

mdlFinc <- finc ~ cChildren + dPeriod + cChildren:dPeriod
rsltOLSFinc <- lm(mdlFinc, data=dfDiD.sub)

mdlWork <- work ~ cChildren + dPeriod + cChildren:dPeriod
rsltOLSWork <- lm(mdlWork, data=dfDiD)

stargazer(rsltOLSEarn, rsltOLSFinc, rsltOLSWork,
          intercept.bottom = FALSE, align = TRUE, no.space=TRUE, type="text")

```

Explain and interpret the findings. What is the effect of the policy introduction on the dependent variables? 
Based on the DiD regression in the table above, the difference-in-difference effect of the EITC on annual earnings is 1,527.96. This indicates an increase in annual earnings of employed women with atleast 1 child after the implementation of the EITC. However, this coefficient is not significant. 

Similarly, the effect of the EITC on annual family income based on the regression above, is 1,803.82. This coefficient indicates that the EITC increased the annual family income of employed woman with atleast 1 child. This coefficient is significant (p < 0.01). 

The difference-in-difference effect of the EITC on the rate of employment of women is 0.031. This coefficient can be interpreted as the increase in employment of women with atleast 1 child, that is, an increase of approximately 3%. This coefficient is significant (p < 0.01). 

## Control variables 
A possible explanation for the results may be that state specific characteristics are not taken into account when comparing averages. Therefore, the state unemployment rate (*urate*) is added as a control variable. The rate of unemployment in states may have an effect on *work*, as women living in a state with a high unemployment rate are likely to be unemployed (*work* = 0) 

Another possible explanation for the results may be the unearned income of women (*unearn*). Women with a high income gained through other resources than work, e.g. through inheritance or investments, may be less inclined to work (*work* = 0). Therefore, *unearn* is added as a control variable. 
 
Lastly, the number of children of woman (*children*) is added as a control variable. It is expected that women with more than 2 children work less than women with less than 2 children, as they may have a harder time balancing work and family life (*work* = 0). Consequently, this variable is added as a control variable. 

```{r}
# EXAMPLE 
mdlB <- employ ~ dState + dPeriod + dState:dPeriod + prix  #prix as controlvariables
mdlC <- employ ~ dState + dPeriod + dState:dPeriod + prix + as.factor(SHEET) #restaurant specific factors as controlvariable


```

Does robust standard errors seem necessary?

```{r}



```


